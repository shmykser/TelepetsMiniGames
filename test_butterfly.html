<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è –±–∞–±–æ—á–∫–∏</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0b1221;
            color: white;
            font-family: Arial, sans-serif;
        }
        #game-container {
            border: 2px solid #333;
            margin: 20px 0;
        }
        .controls {
            margin: 20px 0;
        }
        .control-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 200px;
        }
        input[type="range"] {
            width: 300px;
        }
        .value {
            color: #ffff00;
            font-weight: bold;
        }
        .info {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ü¶ã –¢–µ—Å—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è –±–∞–±–æ—á–∫–∏</h1>
    
    <div class="info">
        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∞–±–æ—á–∫–∏:</h3>
        <p><strong>flutterAmplitude:</strong> <span id="flutterAmplitudeValue" class="value">40</span> - –ê–º–ø–ª–∏—Ç—É–¥–∞ –ø–æ—Ä—Ö–∞–Ω–∏—è</p>
        <p><strong>flutterFrequency:</strong> <span id="flutterFrequencyValue" class="value">0.03</span> - –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ—Ä—Ö–∞–Ω–∏—è</p>
        <p><strong>flutterSpeed:</strong> <span id="flutterSpeedValue" class="value">0.05</span> - –°–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—Ö–∞–Ω–∏—è</p>
        <p><strong>randomness:</strong> <span id="randomnessValue" class="value">0.3</span> - –°—Ç–µ–ø–µ–Ω—å —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏</p>
        <p><strong>directionChangeInterval:</strong> <span id="directionChangeIntervalValue" class="value">2000</span> - –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–º–µ–Ω—ã –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–º—Å)</p>
        <p><strong>directionChangeChance:</strong> <span id="directionChangeChanceValue" class="value">0.1</span> - –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
        <p><strong>targetAttraction:</strong> <span id="targetAttractionValue" class="value">0.7</span> - –°–∏–ª–∞ –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è –∫ —Ü–µ–ª–∏</p>
        <p><strong>minDistanceToTarget:</strong> <span id="minDistanceToTargetValue" class="value">50</span> - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–ª–∏</p>
        <p><strong>directionTransitionSpeed:</strong> <span id="directionTransitionSpeedValue" class="value">0.02</span> - –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
    </div>
    
    <div class="controls">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:</h3>
        
        <div class="control-group">
            <label for="flutterAmplitude">–ê–º–ø–ª–∏—Ç—É–¥–∞ –ø–æ—Ä—Ö–∞–Ω–∏—è:</label>
            <input type="range" id="flutterAmplitude" min="10" max="100" value="40">
            <span id="flutterAmplitudeValue" class="value">40</span>
        </div>
        
        <div class="control-group">
            <label for="flutterFrequency">–ß–∞—Å—Ç–æ—Ç–∞ –ø–æ—Ä—Ö–∞–Ω–∏—è:</label>
            <input type="range" id="flutterFrequency" min="0.01" max="0.1" step="0.01" value="0.03">
            <span id="flutterFrequencyValue" class="value">0.03</span>
        </div>
        
        <div class="control-group">
            <label for="flutterSpeed">–°–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—Ö–∞–Ω–∏—è:</label>
            <input type="range" id="flutterSpeed" min="0.01" max="0.2" step="0.01" value="0.05">
            <span id="flutterSpeedValue" class="value">0.05</span>
        </div>
        
        <div class="control-group">
            <label for="randomness">–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å:</label>
            <input type="range" id="randomness" min="0" max="1" step="0.1" value="0.3">
            <span id="randomnessValue" class="value">0.3</span>
        </div>
        
        <div class="control-group">
            <label for="directionChangeInterval">–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–º–µ–Ω—ã –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</label>
            <input type="range" id="directionChangeInterval" min="500" max="5000" step="100" value="2000">
            <span id="directionChangeIntervalValue" class="value">2000</span>
        </div>
        
        <div class="control-group">
            <label for="directionChangeChance">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</label>
            <input type="range" id="directionChangeChance" min="0" max="1" step="0.05" value="0.1">
            <span id="directionChangeChanceValue" class="value">0.1</span>
        </div>
        
        <div class="control-group">
            <label for="targetAttraction">–ü—Ä–∏—Ç—è–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–∏:</label>
            <input type="range" id="targetAttraction" min="0" max="2" step="0.1" value="0.7">
            <span id="targetAttractionValue" class="value">0.7</span>
        </div>
        
        <div class="control-group">
            <label for="minDistanceToTarget">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–ª–∏:</label>
            <input type="range" id="minDistanceToTarget" min="20" max="100" step="5" value="50">
            <span id="minDistanceToTargetValue" class="value">50</span>
        </div>
        
        <div class="control-group">
            <label for="directionTransitionSpeed">–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</label>
            <input type="range" id="directionTransitionSpeed" min="0.005" max="0.1" step="0.005" value="0.02">
            <span id="directionTransitionSpeedValue" class="value">0.02</span>
        </div>
        
        <div class="control-group">
            <button id="resetButton">–°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
            <button id="testButton">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
        </div>
    </div>
    
    <div id="game-container"></div>
    
    <div class="info">
        <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</h3>
        <ul>
            <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–∑—É–Ω–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–∞–±–æ—á–∫–∏</li>
            <li>–ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã" –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</li>
            <li>–ù–∞–∂–º–∏—Ç–µ "–°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –∏—Å—Ö–æ–¥–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º</li>
            <li>–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —ç–∫—Ä–∞–Ω—É, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—É—é —Ü–µ–ª—å –¥–ª—è –±–∞–±–æ—á–∫–∏</li>
        </ul>
    </div>

    <script type="module">
        import Phaser from 'https://cdn.jsdelivr.net/npm/phaser@3.90.0/dist/phaser.esm.js';
        import { ButterflyMovementStrategy } from './src/systems/strategies/movement/ButterflyMovementStrategy.js';
        import { SystemConfig } from './src/systems/config/SystemConfig.js';

        class ButterflyTestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'ButterflyTestScene' });
                this.butterfly = null;
                this.target = null;
                this.strategy = null;
                this.config = null;
            }

            create() {
                // –°–æ–∑–¥–∞–µ–º —Ü–µ–ª—å (—è–π—Ü–æ)
                this.target = this.add.circle(400, 300, 20, 0xff6b6b);
                this.target.setStrokeStyle(2, 0xff0000);
                
                // –°–æ–∑–¥–∞–µ–º –±–∞–±–æ—á–∫—É
                this.butterfly = this.add.circle(100, 100, 15, 0xffd93d);
                this.butterfly.setStrokeStyle(2, 0xffa500);
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                this.updateConfig();
                
                // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
                this.strategy = new ButterflyMovementStrategy(this.butterfly, this.config);
                this.strategy.setTarget(this.target);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Å–º–µ–Ω—ã —Ü–µ–ª–∏
                this.input.on('pointerdown', (pointer) => {
                    this.target.setPosition(pointer.x, pointer.y);
                    this.strategy.setTarget(this.target);
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª–∑—É–Ω–∫–æ–≤
                this.setupControls();
            }

            update(time, delta) {
                if (this.strategy) {
                    this.strategy.update(time, delta);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏
                    if (this.strategy.isTargetReached(this.target)) {
                        // –°–ª—É—á–∞–π–Ω–∞—è –Ω–æ–≤–∞—è —Ü–µ–ª—å
                        const newX = Phaser.Math.Between(50, 750);
                        const newY = Phaser.Math.Between(50, 550);
                        this.target.setPosition(newX, newY);
                        this.strategy.setTarget(this.target);
                    }
                }
            }

            updateConfig() {
                const movementConfig = {
                    strategy: 'butterfly',
                    speed: 80,
                    attackRange: 25,
                    flutterAmplitude: parseFloat(document.getElementById('flutterAmplitude').value),
                    flutterFrequency: parseFloat(document.getElementById('flutterFrequency').value),
                    flutterSpeed: parseFloat(document.getElementById('flutterSpeed').value),
                    randomness: parseFloat(document.getElementById('randomness').value),
                    directionChangeInterval: parseInt(document.getElementById('directionChangeInterval').value),
                    directionChangeChance: parseFloat(document.getElementById('directionChangeChance').value),
                    targetAttraction: parseFloat(document.getElementById('targetAttraction').value),
                    minDistanceToTarget: parseInt(document.getElementById('minDistanceToTarget').value),
                    directionTransitionSpeed: parseFloat(document.getElementById('directionTransitionSpeed').value)
                };

                this.config = new SystemConfig([movementConfig]);
            }

            setupControls() {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–∑—É–Ω–∫–æ–≤
                const sliders = document.querySelectorAll('input[type="range"]');
                sliders.forEach(slider => {
                    slider.addEventListener('input', (e) => {
                        const valueSpan = document.getElementById(e.target.id + 'Value');
                        if (valueSpan) {
                            valueSpan.textContent = e.target.value;
                        }
                    });
                });

                // –ö–Ω–æ–ø–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                document.getElementById('testButton').addEventListener('click', () => {
                    this.updateConfig();
                    if (this.strategy) {
                        this.strategy.destroy();
                    }
                    this.strategy = new ButterflyMovementStrategy(this.butterfly, this.config);
                    this.strategy.setTarget(this.target);
                });

                // –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞
                document.getElementById('resetButton').addEventListener('click', () => {
                    document.getElementById('flutterAmplitude').value = 40;
                    document.getElementById('flutterFrequency').value = 0.03;
                    document.getElementById('flutterSpeed').value = 0.05;
                    document.getElementById('randomness').value = 0.3;
                    document.getElementById('directionChangeInterval').value = 2000;
                    document.getElementById('directionChangeChance').value = 0.1;
                    document.getElementById('targetAttraction').value = 0.7;
                    document.getElementById('minDistanceToTarget').value = 50;
                    document.getElementById('directionTransitionSpeed').value = 0.02;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
                    sliders.forEach(slider => {
                        const valueSpan = document.getElementById(slider.id + 'Value');
                        if (valueSpan) {
                            valueSpan.textContent = slider.value;
                        }
                    });
                });
            }
        }

        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            backgroundColor: '#0b1221',
            scene: ButterflyTestScene
        };

        const game = new Phaser.Game(config);
    </script>
</body>
</html>
