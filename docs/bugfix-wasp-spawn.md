# Исправление: Осы не спавнят снаряды

## Проблема

Осы (wasp) не спавнили снаряды (projectile), несмотря на правильную конфигурацию в `enemyTypes.js`:

```javascript
wasp: {
    attack: {
        strategy: 'spawn',
        spawnType: 'projectile',
        spawnInterval: 3000,
        cooldown: 3000,
        minSpawnCount: 1,
        maxSpawnCount: 1,
        spawnRange: 10,
        spawnDirection: 'target',
        spawnSpeed: 250,
        maxSpawned: 5
    }
}
```

## Причина

Проблема была в порядке приоритетов источников конфигурации в `AICoordinator.js`.

### Как это работало (неправильно):

В `AICoordinator.setupSystems()` создавалась конфигурация атаки:

```javascript
const attackConfig = new SystemConfig([
    this.config.get('attack', {}),     // Объект attack
    this.config.get('behaviorParams', {}),
    this.config                         // Родительская конфигурация (ВЫСШИЙ приоритет)
]);
```

В `SystemConfig.get()` источники проверяются в **обратном порядке** (последний имеет наивысший приоритет). Это значит:
1. Сначала проверялась родительская конфигурация `this.config`
2. Затем `behaviorParams`
3. Только потом объект `attack` с параметрами спавна

Когда `SpawnAttackStrategy` вызывал `config.get('spawnInterval')`:
- Родительская конфигурация (которая сама является `SystemConfig`) начинала искать `spawnInterval` в своих источниках
- Не находила его (он находится внутри объекта `attack`)
- Возвращала `undefined`
- Из-за особенностей работы вложенных `SystemConfig`, значения из объекта `attack` не доходили до `SpawnAttackStrategy`

## Решение

Изменен порядок источников в `AICoordinator.js`, чтобы специфичные конфигурации (attack, movement, collision, pathfinding, stealth) имели **наивысший приоритет**:

```javascript
const attackConfig = new SystemConfig([
    this.config,                        // Родительская конфигурация (НИЗШИЙ приоритет)
    this.config.get('behaviorParams', {}),
    this.config.get('attack', {})       // Объект attack (ВЫСШИЙ приоритет)
]);
```

Теперь порядок разрешения:
1. Сначала проверяется объект `attack` (содержит все параметры спавна)
2. Затем `behaviorParams`
3. Только потом родительская конфигурация

Это гарантирует, что `SpawnAttackStrategy` получит все необходимые параметры (`spawnInterval`, `minSpawnCount`, `maxSpawnCount`, `spawnType`, и т.д.) из объекта `attack`.

## Измененные файлы

- `src/systems/core/AICoordinator.js`:
  - Изменен порядок источников для `movementConfig`
  - Изменен порядок источников для `attackConfig`
  - Изменен порядок источников для `collisionConfig`
  - Изменен порядок источников для `pathfindingConfig`
  - Изменен порядок источников для `stealthSystemConfig`

## Проверка исправления

После применения изменений:
1. Запустите игру
2. Дождитесь появления осы (wasp)
3. Оса должна летать по орбитальной траектории вокруг яйца
4. Каждые 3 секунды оса должна спавнить снаряд (projectile) в направлении яйца
5. Снаряд должен лететь к яйцу и наносить урон при попадании

## Дополнительная информация

### Архитектура конфигурации

Система конфигурации использует многоуровневую иерархию:
1. `Enemy` создает `SystemConfig` с данными врага
2. `AICoordinator` создает специфичные конфигурации для каждой системы
3. Каждая система (AttackSystem, MovementSystem, etc.) использует свою конфигурацию
4. Стратегии (SpawnAttackStrategy, OrbitalMovementStrategy, etc.) получают доступ к параметрам через конфигурацию системы

### Принцип работы SystemConfig

`SystemConfig` поддерживает множественные источники конфигурации с приоритетами:
- Источники хранятся в массиве
- При запросе значения источники проверяются в **обратном порядке**
- Последний источник в массиве имеет **наивысший приоритет**
- Если значение найдено, поиск прекращается
- Если значение не найдено, возвращается значение по умолчанию

### Рекомендации

При создании конфигураций в `AICoordinator.setupSystems()`:
1. Общие/базовые источники помещайте в начало массива
2. Специфичные источники помещайте в конец массива
3. Порядок: `[базовая конфигурация, общие параметры, специфичные параметры]`
4. Специфичные параметры должны переопределять базовые значения

Пример правильного порядка:
```javascript
const config = new SystemConfig([
    this.config,              // Базовая конфигурация
    this.config.get('behaviorParams', {}),  // Общие параметры поведения
    this.config.get('attack', {})           // Специфичные параметры атаки (ВЫСШИЙ ПРИОРИТЕТ)
]);
```

