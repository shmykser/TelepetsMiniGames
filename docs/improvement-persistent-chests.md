# üîß –£–õ–£–ß–®–ï–ù–ò–ï: –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—É–Ω–¥—É–∫–æ–≤

**–î–∞—Ç–∞:** 19 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ –≤ –¥–æ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–æ—Å—å –Ω–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—É–Ω–¥—É–∫–æ–≤  
**–†–µ—à–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Å—É–Ω–¥—É–∫–∞—Ö –≤ WorldGenerator, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## üéØ –¶–ï–õ–¨

–°–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã:
1. –ö–∞–∂–¥—ã–π –¥–æ–º –∏–º–µ–ª **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—É–Ω–¥—É–∫–æ–≤
2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É–Ω–¥—É–∫–æ–≤ –∏ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–æ—Å—å **–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∏—Ä–∞**
3. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å—É–Ω–¥—É–∫–æ–≤ (–æ—Ç–∫—Ä—ã—Ç/–æ–ø—É—Å—Ç–æ—à–µ–Ω) **—Å–æ—Ö—Ä–∞–Ω—è–ª–æ—Å—å** –º–µ–∂–¥—É –≤—Ö–æ–¥–∞–º–∏
4. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è **–±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ë–î**

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê

### –ë—ã–ª–æ:
```javascript
// HouseInteriorScene.js - generateChestContents()
generateChestContents() {
    return {
        coins: 10 + Math.floor(Math.random() * 40), // ‚ùå –ö–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        jewels: Math.floor(Math.random() * 5),
        keys: Math.random() > 0.7 ? 1 : 0,
        isLocked: Math.random() > 0.5,
        lockLevel: Math.floor(Math.random() * 3) + 1
    };
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ –≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –¥–æ–º –∏–≥—Ä–æ–∫ –≤–∏–¥–µ–ª —Ä–∞–∑–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ WorldGenerator

**–§–∞–π–ª:** `src/systems/world/WorldGenerator.js`

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `generateChestsForHouse()`:

```javascript
generateChestsForHouse(count) {
    const chests = [];
    
    for (let i = 0; i < count; i++) {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –û–î–ò–ù –†–ê–ó –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∏—Ä–∞
        const coins = 10 + Math.floor(this.rng() * 40);
        const jewels = Math.floor(this.rng() * 5);
        const keys = this.rng() > 0.7 ? 1 : 0;
        
        const isLocked = this.rng() > 0.5;
        const lockLevel = isLocked ? Math.floor(this.rng() * 3) + 1 : 0;
        
        chests.push({
            id: `chest_${i}`,
            coins: coins,
            jewels: jewels,
            keys: keys,
            isLocked: isLocked,
            lockLevel: lockLevel,
            isOpened: false,  // ‚úÖ –§–ª–∞–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            isEmpty: false     // ‚úÖ –§–ª–∞–≥ –æ–ø—É—Å—Ç–æ—à–µ–Ω–∏—è
        });
    }
    
    return chests;
}
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–º–∞

**–ë—ã–ª–æ:**
```javascript
house: {
    id: 'house_1',
    ownerName: '–ò–≥—Ä–æ–∫ 2',
    treasures: {
        coins: 150,  // ‚ùå –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        jewels: 5
    }
}
```

**–°—Ç–∞–ª–æ:**
```javascript
house: {
    id: 'house_1',
    ownerId: 'player_1',
    ownerName: '–ò–≥—Ä–æ–∫ 2',
    chests: [                           // ‚úÖ –ú–∞—Å—Å–∏–≤ —Å—É–Ω–¥—É–∫–æ–≤
        {
            id: 'chest_0',
            coins: 25,                  // ‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            jewels: 2,
            keys: 1,
            isLocked: true,
            lockLevel: 2,
            isOpened: false,            // ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ
            isEmpty: false
        },
        {
            id: 'chest_1',
            coins: 10,
            jewels: 0,
            keys: 0,
            isLocked: false,
            lockLevel: 0,
            isOpened: false,
            isEmpty: false
        }
    ],
    isPlayerHouse: false
}
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ HouseInteriorScene

**–ë—ã–ª–æ:**
```javascript
createChests() {
    const numChests = 2 + Math.floor(Math.random() * 2);
    
    for (let i = 0; i < numChests; i++) {
        const contents = this.generateChestContents(); // ‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ –ª–µ—Ç—É
        const chest = new Chest(this, x, y, contents);
    }
}
```

**–°—Ç–∞–ª–æ:**
```javascript
createChests() {
    const chestsData = this.houseData.chests || []; // ‚úÖ –ë–µ—Ä–µ–º –≥–æ—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    
    chestsData.forEach((chestData, i) => {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–ø—É—Å—Ç–æ—à–µ–Ω–Ω—ã–µ
        if (chestData.isEmpty) return;
        
        const chest = new Chest(this, x, y, {
            id: chestData.id,
            coins: chestData.coins,        // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            jewels: chestData.jewels,
            keys: chestData.keys,
            isLocked: chestData.isLocked,
            lockLevel: chestData.lockLevel
        });
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        if (chestData.isOpened) {
            chest.isOpened = true;
            chest.setText('üì¶');
            chest.setAlpha(0.7);
            chest.disableInteractive();
        }
    });
}
```

### 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—É–Ω–¥—É–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –º–∏—Ä–∞:

```javascript
onChestOpened(data, chestData) {
    const contents = data.chest.collectContents();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –¥–∞–Ω–Ω—ã—Ö –º–∏—Ä–∞
    if (chestData) {
        chestData.isOpened = true;   // ‚úÖ –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–∫—Ä—ã—Ç—ã–π
        chestData.isEmpty = true;    // ‚úÖ –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –ø—É—Å—Ç–æ–π
        chestData.coins = 0;
        chestData.jewels = 0;
        chestData.keys = 0;
    }
    
    console.log('üíæ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å—É–Ω–¥—É–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö –º–∏—Ä–∞');
}
```

### 5. –î–æ–º –∏–≥—Ä–æ–∫–∞

–î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–º–∞ –∏–≥—Ä–æ–∫–∞ —Å –æ–¥–Ω–∏–º —Å—É–Ω–¥—É–∫–æ–º –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è:

```javascript
generatePlayerHouse() {
    const playerChest = [{
        id: 'player_chest_0',
        coins: 0,           // ‚úÖ –ü—É—Å—Ç–æ–π —Å—É–Ω–¥—É–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É–∫—Ä–∞–¥–µ–Ω–Ω–æ–≥–æ
        jewels: 0,
        keys: 0,
        isLocked: false,
        lockLevel: 0,
        isOpened: false,
        isEmpty: false
    }];
    
    return {
        id: 'player_house',
        ownerId: 'player',
        ownerName: '–ú–æ–π –¥–æ–º',
        isPlayerHouse: true,
        chests: playerChest,
        // ...
    };
}
```

---

## üìä –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ö–û–î–ï

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- ‚úÖ `WorldGenerator.generateChestsForHouse(count)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—É–Ω–¥—É–∫–æ–≤

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- ‚úÖ `WorldGenerator.generateHouses()` - –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ generateChestsForHouse
- ‚úÖ `WorldGenerator.generatePlayerHouse()` - –¥–æ–±–∞–≤–ª–µ–Ω —Å—É–Ω–¥—É–∫ –∏–≥—Ä–æ–∫–∞
- ‚úÖ `HouseInteriorScene.createChests()` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `HouseInteriorScene.onChestOpened()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- ‚ùå `HouseInteriorScene.generateChestContents()` - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω

**–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫:** ~90 (–¥–æ–±–∞–≤–ª–µ–Ω–æ ~70, —É–¥–∞–ª–µ–Ω–æ ~20)

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢

–¢–µ–ø–µ—Ä—å:
1. ‚úÖ –ö–∞–∂–¥—ã–π –¥–æ–º –∏–º–µ–µ—Ç **–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ** —Å—É–Ω–¥—É–∫–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏—Ä–∞
2. ‚úÖ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—É–Ω–¥—É–∫–æ–≤ **–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è** –º–µ–∂–¥—É –≤—Ö–æ–¥–∞–º–∏
3. ‚úÖ –û—Ç–∫—Ä—ã—Ç—ã–µ —Å—É–Ω–¥—É–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è **–æ—Ç–∫—Ä—ã—Ç—ã–º–∏**
4. ‚úÖ –û–ø—É—Å—Ç–æ—à–µ–Ω–Ω—ã–µ —Å—É–Ω–¥—É–∫–∏ **–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è**
5. ‚úÖ –î–æ–º –∏–≥—Ä–æ–∫–∞ –∏–º–µ–µ—Ç **—Å–≤–æ–π —Å—É–Ω–¥—É–∫** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
6. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –¥–ª—è **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ë–î**

---

## üéÆ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
1. –í–æ–π—Ç–∏ –≤ –¥–æ–º –∏–≥—Ä–æ–∫–∞ "–ò–≥—Ä–æ–∫ 2"
2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É–Ω–¥—É–∫–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
3. –í—ã–π—Ç–∏ –∏–∑ –¥–æ–º–∞
4. –°–Ω–æ–≤–∞ –≤–æ–π—Ç–∏ –≤ –¥–æ–º "–ò–≥—Ä–æ–∫ 2"
5. ‚úÖ **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –¢–µ –∂–µ —Å—É–Ω–¥—É–∫–∏, —Ç–æ –∂–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
1. –í–æ–π—Ç–∏ –≤ –¥–æ–º "–ò–≥—Ä–æ–∫ 3"
2. –û—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—ã–π —Å—É–Ω–¥—É–∫
3. –°–æ–±—Ä–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
4. –í—ã–π—Ç–∏ –∏–∑ –¥–æ–º–∞
5. –°–Ω–æ–≤–∞ –≤–æ–π—Ç–∏ –≤ –¥–æ–º "–ò–≥—Ä–æ–∫ 3"
6. ‚úÖ **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ü–µ—Ä–≤—ã–π —Å—É–Ω–¥—É–∫ –æ—Ç–∫—Ä—ã—Ç (üì¶) –∏–ª–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–æ–º –∏–≥—Ä–æ–∫–∞
1. –í–æ–π—Ç–∏ –≤ —Å–≤–æ–π –¥–æ–º (üè° –≤ —Ü–µ–Ω—Ç—Ä–µ)
2. ‚úÖ **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –û–¥–∏–Ω –ø—É—Å—Ç–æ–π —Å—É–Ω–¥—É–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è

---

## üîÆ –ü–û–î–ì–û–¢–û–í–ö–ê –ö –ë–î

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î:

```javascript
// –¢–∞–±–ª–∏—Ü–∞: houses
{
    id: 'house_1',
    ownerId: 'player_1',
    ownerName: '–ò–≥—Ä–æ–∫ 2',
    position: { x, y },
    // ...
}

// –¢–∞–±–ª–∏—Ü–∞: chests
{
    id: 'chest_0',
    houseId: 'house_1',    // FK -> houses
    coins: 25,
    jewels: 2,
    keys: 1,
    isLocked: true,
    lockLevel: 2,
    isOpened: false,
    isEmpty: false
}
```

**–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –ë–î:**
1. –ó–∞–º–µ–Ω–∏—Ç—å `WorldGenerator.generate()` –Ω–∞ –∑–∞–ø—Ä–æ—Å –∫ –ë–î
2. –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—É–Ω–¥—É–∫–∞ - UPDATE –∑–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ chests
3. –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –¥–æ–º - JOIN –∑–∞–ø—Ä–æ—Å houses + chests
4. –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Ä–∞–∑ –≤ 24 —á–∞—Å–∞)

---

## üìù –í–´–í–û–î–´

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –õ–æ–≥–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –∏–≥—Ä–æ–∫–∞
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ë–î
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–Ω–æ–≤—ã–µ —Ç–∏–ø—ã —Å—É–Ω–¥—É–∫–æ–≤, –ª–æ–≤—É—à–∫–∏)
- ‚úÖ –ß–∏—Ç–∞–µ–º—ã–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –∫–æ–¥

**–ß—Ç–æ –¥–∞–ª—å—à–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ—á–∏—Å—Ç–∫–∏ –º–∏—Ä–∞ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞
2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∏–≥—Ä—ã
3. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Ç–∏–ø–æ–≤ —Å—É–Ω–¥—É–∫–æ–≤ (–±–æ–ª—å—à–∏–µ, –º–∞–ª–µ–Ω—å–∫–∏–µ, –º–∏–º–µ—Ç–∏–∫–∏)
4. –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–æ–≤—É—à–µ–∫ –Ω–∞ —Å—É–Ω–¥—É–∫–∞—Ö

---

*–£–ª—É—á—à–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: 19.10.2025*


